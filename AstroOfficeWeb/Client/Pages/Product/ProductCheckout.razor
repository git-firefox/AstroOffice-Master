@page "/checkout"

@using AstroOfficeWeb.Client.Services
@using MudBlazor

@inject ProductService ProductService
@inject NavigationManager NavigationManager
@inject StateContainerService StateContainerService
@inject IJSRuntime JSRuntime
@inject ILocalStorageService LocalStorage
@inject ISwaggerApiService Swagger

<ViewAddressModal @ref="Modal_ViewAddress" Addresses="Addresses" OnSelectAddressChanged="OnSelect_Address" CountryDTOs="CountryDTOs"></ViewAddressModal>

<div class="container-fluid p-3">
    <h1 class="pt-4 pb-2 font-weight-bold "> Checkout </h1>
    <section class="content">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-xl-8">
                                <div id="checkout-nav-pills-wizard" class="twitter-bs-wizard form-wizard-header">
                                    <ul class="twitter-bs-wizard-nav mb-2 nav nav-pills nav-justified">
                                        <li class="nav-item">
                                            <a @ref="ER_ABillingInfo" href="#billing-info" class="nav-link active" data-toggle="tab">
                                                <span class="number">01</span>
                                                <span class="d-none d-sm-inline">Billing Info</span>
                                            </a>
                                        </li>

                                        @if (BillingInfo.ShipToDifferentAddress)
                                        {
                                            <li class="nav-item">
                                                <a @ref="ER_AShippingInfo" href="#shipping-info" class="nav-link" data-toggle="tab">
                                                    <span class="number">02</span>
                                                    <span class="d-none d-sm-inline">Shipping Info</span>
                                                </a>
                                            </li>
                                        }

                                        <li class="nav-item">
                                            <a @ref="ER_APaymentInfo" href="#payment-info" class="nav-link" data-bs-toggle="tab" data-toggle="tab">
                                                <span class="number"> @(BillingInfo.ShipToDifferentAddress ? "03" : "02")</span>
                                                <span class="d-none d-sm-inline">Payment Info</span>
                                            </a>
                                        </li>
                                    </ul>

                                    <div class="tab-content twitter-bs-wizard-tab-content">
                                        <div class="tab-pane active" id="billing-info">
                                            <EditForm Model="BillingInfo" OnValidSubmit="OnSubmit_BillingInfo">
                                                <DataAnnotationsValidator />
                                                <div>
                                                    <h4 class="header-title d-inline">Billing Information</h4>
                                                    <div class="float-end">
                                                        <button class="btn btn-link" type="button" @onclick="()=>OnClick_BtnChangeAddress(0)">
                                                            <i class="fa-regular fa-pen-to-square"></i> Change
                                                        </button>
                                                    </div>
                                                    <p class="sub-header">
                                                        Fill the form below in order to
                                                        send you the order's invoice.
                                                    </p>


                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-first-name" class="form-label">First Name</label> <span class="text-danger">*</span>
                                                                <ValidationMessage For=@(() => BillingInfo!.FirstName) style="position:revert;" />
                                                                <InputText @bind-Value="BillingInfo!.FirstName" class="form-control" type="text" placeholder="Enter your first name" id="billing-first-name" />
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-last-name" class="form-label">Last Name</label> <span class="text-danger">*</span>
                                                                <ValidationMessage For=@(() => BillingInfo!.LastName) style="position:revert;" />
                                                                <InputText @bind-Value="BillingInfo!.LastName" class="form-control" type="text" placeholder="Enter your last name" id="billing-last-name" />
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-email-address" class="form-label">Email Address <span class="text-danger">*</span></label>
                                                                <ValidationMessage For=@(() => BillingInfo!.Email) style="position:revert;" />
                                                                <InputText @bind-Value="BillingInfo!.Email" class="form-control" type="email" placeholder="Enter your email" id="billing-email-address" />
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-phone" class="form-label">Phone <span class="text-danger">*</span></label>
                                                                <ValidationMessage For=@(() => BillingInfo!.PhoneNumber) style="position:revert;" />
                                                                <InputText @ref="Input_MobileNumber" @bind-Value="BillingInfo!.PhoneNumber" class="form-control" type="text" id="billing-phone" @onfocusout="OnFocusOut_InputPhoneNumber" />
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div class="mb-3">
                                                                <label for="billing-address" class="form-label">Address 1</label>
                                                                <ValidationMessage For=@(() => BillingInfo!.AddressLine1) style="position:revert;" />
                                                                <InputText @bind-Value="BillingInfo!.AddressLine1" class="form-control" type="text" placeholder="Enter full address" id="billing-address" />
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->

                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div class="mb-3">
                                                                <label for="billing-address" class="form-label">Address 2</label>
                                                                <ValidationMessage For=@(() => BillingInfo!.AddressLine2) style="position:revert;" />
                                                                <InputText @bind-Value="BillingInfo!.AddressLine2" class="form-control" type="text" placeholder="Enter full address" id="billing-address" />
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="billing-town-city" class="form-label">Town / City</label>
                                                                <InputText @bind-Value="BillingInfo!.City" class="form-control" type="text" placeholder="Enter your city name" id="billing-town-city" />
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="billing-state" class="form-label">State</label>
                                                                <InputText @bind-Value="BillingInfo!.State" class="form-control" type="text" placeholder="Enter your state" id="billing-state" />
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="billing-zip-postal" class="form-label">Zip Code</label>
                                                                <InputText @ref="Input_ZipCode" @bind-Value="BillingInfo!.ZipCode" @onfocusout="OnFocusOut_InputZipCode" class="form-control" type="text" placeholder="Enter your zip code" id="billing-zip-postal" />
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="billing-landmark" class="form-label">Landmark</label>
                                                                <InputText @bind-Value="BillingInfo!.Landmark" class="form-control" type="text" placeholder="Enter your Landmark" id="billing-landmark" />
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label class="form-label">Country</label>
                                                                <InputSelect @ref="Input_Country" @bind-Value="BillingInfo!.ACountrySno" class="form-control" data-placeholder="Select a Country" @onblur="OnBlur_Country">
                                                                    <option value="0">Select Country</option>
                                                                    @foreach (var country in CountryDTOs)
                                                                    {
                                                                        <option value="@country.Sno">@country.Country</option>
                                                                    }
                                                                </InputSelect>
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->

                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div class="mb-3">
                                                                <div class="form-check">
                                                                    <InputCheckbox @bind-Value="BillingInfo.ShipToDifferentAddress" class="form-check-input" type="checkbox" id="shipdifferent-check" />
                                                                    <label class="form-check-label" for="shipdifferent-check">Ship to different address ?</label>
                                                                </div>
                                                            </div>

                                                            <div class="mb-3 mt-3">
                                                                <label for="example-textarea" class="form-label">Order Notes:</label>
                                                                <textarea class="form-control" id="example-textarea" rows="3" placeholder="Write some note.."></textarea>
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->

                                                </div>
                                                <div class="d-flex mb-3">
                                                    <div class="">
                                                        <a href="shopping-cart" class="btn btn-custom"><i class="fas fa-arrow-left mx-2"></i> Back to Shopping Cart </a>
                                                    </div>
                                                    <div class="ml-auto">
                                                        <button class="btn btn-success" type="submit"><i class="fas fa-truck mx-2"></i> Update BillingInfo & @(BillingInfo.ShipToDifferentAddress ? "Proceed to Shipping" : "Proceed to Payment ") </button>
                                                    </div>
                                                </div>

                                            </EditForm>
                                        </div>

                                        @if (BillingInfo.ShipToDifferentAddress)
                                        {
                                            <div class="tab-pane" id="shipping-info">
                                                <div>
                                                    <h4 class="header-title">Saved Address</h4>

                                                    <p class="sub-header">
                                                        Fill the form below in order to
                                                        send you the order's invoice.
                                                    </p>

                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="border p-3 rounded mb-3 mb-md-0">

                                                                <div class="form-check form-check-inline font-16">
                                                                    <input class="form-check-input" type="radio" name="checkoutaddressRadio" id="checkoutaddressRadio1" checked="">
                                                                    <label class="form-check-label" for="checkoutaddressRadio1">Home</label>
                                                                </div>

                                                                <div class="float-end d-inline">
                                                                    <a href="#"><i class="fas fa-edit text-muted font-20"></i></a>
                                                                </div>
                                                                <h5 class="mt-3">Brent Rowe</h5>

                                                                <p class="mb-1"><span class="fw-semibold me-2">Address:</span> 3559 Roosevelt Wilson Lane San Bernardino, CA 92405</p>
                                                                <p class="mb-1"><span class="fw-semibold me-2">Phone:</span> (123) 456-7890</p>
                                                                <p class="mb-0"><span class="fw-semibold me-2">Mobile:</span> (+01) 12345 67890</p>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="border p-3 rounded mb-3 mb-md-0">
                                                                <div class="form-check form-check-inline font-16">
                                                                    <input class="form-check-input" type="radio" name="checkoutaddressRadio" id="checkoutaddressRadio2">
                                                                    <label class="form-check-label" for="checkoutaddressRadio2">Office</label>
                                                                </div>
                                                                <div class="float-end d-inline">
                                                                    <a href="#"><i class="fas fa-edit text-muted font-20"></i></a>
                                                                </div>
                                                                <h5 class="mt-3">Brent Rowe</h5>

                                                                <p class="mb-1"><span class="fw-semibold me-2">Address:</span> 3559 Roosevelt Wilson Lane San Bernardino, CA 92405</p>
                                                                <p class="mb-1"><span class="fw-semibold me-2">Phone:</span> (123) 456-7890</p>
                                                                <p class="mb-0"><span class="fw-semibold me-2">Mobile:</span> (+01) 12345 67890</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- end row-->

                                                    <h4 class="header-title mt-4">Shipping Method</h4>

                                                    <p class="text-muted mb-3">
                                                        Fill the form below in order to
                                                        send you the order's invoice.
                                                    </p>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="border p-3 rounded mb-3">
                                                                <div class="form-check form-check-inline font-16 mb-0">
                                                                    <input class="form-check-input" type="radio" name="shippingMethod" id="shippingMethodRadio1" checked="">
                                                                    <label class="form-check-label" for="shippingMethodRadio1">Standard Delivery - FREE</label>
                                                                </div>

                                                                <p class="mb-0 ps-3 pt-1">Estimated 5-7 days shipping (Duties and tax may be due upon delivery)</p>
                                                            </div>

                                                            <div class="border p-3 rounded">
                                                                <div class="form-check form-check-inline font-16 mb-0">
                                                                    <input class="form-check-input" type="radio" name="shippingMethod" id="shippingMethodRadio2">
                                                                    <label class="form-check-label" for="shippingMethodRadio2">Fast Delivery - $25</label>
                                                                </div>
                                                                <p class="mb-0 ps-3 pt-1">Estimated 1-2 days shipping (Duties and tax may be due upon delivery)</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- end row-->
                                                </div>

                                                <div class="d-flex my-3">
                                                    <div class="">
                                                        <button class="btn btn-custom" type="button" @onclick="()=>OnClick_BtnProceed(ProceedStatus.Billing)"><i class="fas fa-arrow-left mx-2"></i> Back to Billing </button>
                                                    </div>
                                                    <div class="ml-auto">
                                                        <button class="btn btn-success" type="button" @onclick="()=>OnClick_BtnProceed(ProceedStatus.Payment)"><i class="fas fa-money-bill"></i> Continue to Payment </button>
                                                    </div>
                                                </div>

                                            </div>
                                        }

                                        <div class="tab-pane" id="payment-info">
                                            <div>
                                                <h4 class="header-title">Payment Selection</h4>

                                                <p class="sub-header">
                                                    Fill the form below in order to
                                                    send you the order's invoice.
                                                </p>

                                                <!-- Pay with Paypal box-->
                                                <div class="border p-3 mb-3 rounded">
                                                    <div class="float-end">
                                                        <i class="fab fa-cc-paypal font-24 text-primary"></i>
                                                    </div>

                                                    <div class="form-check form-check-inline font-16 mb-0">
                                                        <input class="form-check-input" type="radio" name="billingOptions" id="BillingOptRadio1">
                                                        <label class="form-check-label" for="BillingOptRadio1">Pay with Paypal</label>
                                                    </div>
                                                    <p class="mb-0 ps-3 pt-1">You will be redirected to PayPal website to complete your purchase securely.</p>

                                                </div>
                                                <!-- end Pay with Paypal box-->
                                                <!-- Credit/Debit Card box-->
                                                <div class="border p-3 mb-3 rounded">
                                                    <div class="float-end">
                                                        <i class="far fa-credit-card font-24 text-primary"></i>
                                                    </div>
                                                    <div class="form-check form-check-inline font-16 mb-0">
                                                        <input class="form-check-input" type="radio" name="billingOptions" id="BillingOptRadio2" checked="">
                                                        <label class="form-check-label" for="BillingOptRadio2">Credit / Debit Card</label>
                                                    </div>
                                                    <p class="mb-0 ps-3 pt-1">Safe money transfer using your bank account. We support Mastercard, Visa, Discover and Stripe.</p>

                                                    <div class="row mt-4">
                                                        <div class="col-md-12">
                                                            <div class="mb-2">
                                                                <label for="card-number" class="form-label">Card Number</label>
                                                                <input type="text" id="card-number" class="form-control" data-toggle="input-mask" data-mask-format="0000 0000 0000 0000" placeholder="4242 4242 4242 4242">
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="mb-2">
                                                                <label for="card-name-on" class="form-label">Name on card</label>
                                                                <input type="text" id="card-name-on" class="form-control" placeholder="Master Name">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="mb-2">
                                                                <label for="card-expiry-date" class="form-label">Expiry date</label>
                                                                <input type="text" id="card-expiry-date" class="form-control" data-toggle="input-mask" data-mask-format="00/00" placeholder="MM/YY">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="mb-2">
                                                                <label for="card-cvv" class="form-label">CVV code</label>
                                                                <input type="text" id="card-cvv" class="form-control" data-toggle="input-mask" data-mask-format="000" placeholder="012">
                                                            </div>
                                                        </div>
                                                    </div> <!-- end row -->
                                                </div>
                                                <!-- end Credit/Debit Card box-->
                                                <!-- Cash on Delivery box-->
                                                <div class="border p-3 mb-3 rounded">
                                                    <div class="float-end">
                                                        <i class="fas fa-money-bill-alt font-24 text-primary"></i>
                                                    </div>
                                                    <div class="form-check form-check-inline font-16 mb-0">
                                                        <input class="form-check-input" type="radio" name="billingOptions" id="BillingOptRadio3">
                                                        <label class="form-check-label" for="BillingOptRadio3">Cash on Delivery</label>
                                                    </div>
                                                    <p class="mb-0 ps-3 pt-1">Pay with cash when your order is delivered.</p>
                                                </div>
                                                <!-- end Cash on Delivery box-->
                                            </div>

                                            <div class="d-flex mb-3">
                                                <div class="">
                                                    @if (BillingInfo.ShipToDifferentAddress)
                                                    {
                                                        <button class="btn btn-custom" type="button" @onclick="()=>OnClick_BtnProceed(ProceedStatus.Shipping)"><i class="fas fa-arrow-left mx-2"></i> Back to Shipping </button>
                                                    }
                                                    else
                                                    {
                                                        <button class="btn btn-custom" type="button" @onclick="()=>OnClick_BtnProceed(ProceedStatus.Billing)"><i class="fas fa-arrow-left mx-2"></i> Back to Billing </button>
                                                    }
                                                </div>
                                                <div class="ml-auto">
                                                    <button class="btn btn-success" type="button" @onclick="()=>OnClick_BtnProceed(ProceedStatus.Payment)"><i class="fas fa-check-circle mx-2"></i> Place Order </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="col-xl-4">
                                <div class="checkout-order-review">
                                    <div class="card mt-4 mt-xl-0">
                                        <div class="card-body">
                                            <h4 class="header-title mb-3">Order Summary</h4>

                                            <div class="table-responsive">
                                                <table class="table table-centered table-nowrap mb-0">
                                                    <tbody>
                                                        <tr>
                                                            <td style="width: 80px;">
                                                                <img src="../assets/images/products/product-1.png" alt="product-img" title="product-img" class="rounded" height="48">
                                                            </td>
                                                            <td>
                                                                <a href="ecommerce-product-detail.html" class="text-body fw-semibold">Blue color T-shirt</a>
                                                                <small class="d-block">1 x $ 41</small>
                                                            </td>

                                                            <td class="text-end">
                                                                $ 41
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <img src="../assets/images/products/product-6.png" alt="product-img" title="product-img" class="rounded" height="48">
                                                            </td>

                                                            <td>
                                                                <a href="ecommerce-product-detail.html" class="text-body fw-semibold">Blue Hoodie for men</a>
                                                                <small class="d-block">2 x $ 45</small>
                                                            </td>
                                                            <td class="text-end">
                                                                $ 90
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <img src="../assets/images/products/product-8.png" alt="product-img" title="product-img" class="rounded me-2" height="48">
                                                            </td>
                                                            <td>
                                                                <a href="ecommerce-product-detail.html" class="text-body fw-semibold">Full sleeve Pink T-shirt</a>
                                                                <small class="d-block">1 x $ 45</small>
                                                            </td>
                                                            <td class="text-end">
                                                                $ 45
                                                            </td>
                                                        </tr>
                                                        <tr class="text-end">
                                                            <td colspan="2">
                                                                <h6 class="m-0">Sub Total:</h6>
                                                            </td>
                                                            <td class="text-end">
                                                                $ 176
                                                            </td>
                                                        </tr>
                                                        <tr class="text-end">
                                                            <td colspan="2">
                                                                <h6 class="m-0">Shipping:</h6>
                                                            </td>
                                                            <td class="text-end">
                                                                FREE
                                                            </td>
                                                        </tr>
                                                        <tr class="text-end">
                                                            <td colspan="2">
                                                                <h5 class="m-0">Total:</h5>
                                                            </td>
                                                            <td class="text-end fw-semibold">
                                                                $ 176
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>