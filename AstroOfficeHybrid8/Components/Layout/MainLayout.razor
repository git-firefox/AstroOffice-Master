@using AstroOfficeWeb.Components.MyComponents
@inherits LayoutComponentBase

<MudDialogProvider />
<MudSnackbarProvider />
<MudThemeProvider Theme="AppTheme" />

<CascadingValue Value="this">
    @* <ErrorBoundary>
    <ChildContent> *@
    <MudLayout>
        <MudThemeManagerButton OnClick="@((e) => OnOpenChangedThemeManager(true))" />
        <MudThemeManager Open="IsTemeManagerOpen" OpenChanged="OnOpenChangedThemeManager" Theme="ThemeManagerTheme" ThemeChanged="OnThemeChanged" />

        <AuthorizeView>
            <Authorized>
                <MudAppBar Elevation="1">
                    <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="OnClick_BtnMenu" />
                </MudAppBar>

                <MudDrawer @bind-Open="IsDrawerOpen" ClipMode="ThemeManagerTheme.DrawerClipMode" Elevation="ThemeManagerTheme.DrawerElevation" Breakpoint="Breakpoint.Lg" Variant="DrawerVariant.Responsive" PreserveOpenState="false">
                    <MudDrawerHeader>
                        <MudStack Row="true">
                            <MudAvatar Size="Size.Medium">
                                @context?.User?.Identity?.Name?.Substring(0, 1).ToUpper()
                            </MudAvatar>
                            <MudStack Justify="Justify.Center" Spacing="0">
                                <MudText Typo="Typo.body1">
                                    @if (context?.User?.Identity?.Name != null)
                                    {
                                        @($"{context.User.Identity.Name.Substring(0, 1).ToUpper()}{context.User.Identity.Name.Substring(1).ToLower()}")
                                    }
                                </MudText>
                            </MudStack>
                        </MudStack>
                    </MudDrawerHeader>

                    <AuthorizeView Roles=@(ApplicationConst.Role_AdminUser + "," + ApplicationConst.Role_Astrologer) Context="check">
                        <Authorized>

                            <MudNavLink Href="/" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Dashboard" /> Home
                            </MudNavLink>

                            <MudNavLink Href="/dashboard" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Dashboard" /> Dashboard
                            </MudNavLink>

                            <MudNavLink Href="/saved-kundalis" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.TableView" />
                                Saved Kundali
                            </MudNavLink>

                            <MudNavLink Href="/viewed-kundalis" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.TableView" />
                                Viewed Kundali
                            </MudNavLink>

                        </Authorized>
                    </AuthorizeView>


                    <AuthorizeView Roles=@(ApplicationConst.Role_AdminUser) Context="check1">
                        <Authorized>
                            <MudNavLink Href="/transactions" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                                Transaction
                            </MudNavLink>

                            <MudNavLink Href="/token-recharge" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                                Recharge
                            </MudNavLink>
                        </Authorized>

                    </AuthorizeView>

                    <AuthorizeView Roles="@(ApplicationConst.Role_User)" Context="check2">
                        <Authorized>
                            <MudNavLink Href="/products" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Shop" />
                                Shop
                            </MudNavLink>

                            <MudNavLink Href="/product-cart" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.ShoppingCart" /> Cart
                            </MudNavLink>

                            <MudNavLink Href="/my-orders" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                                Orders
                            </MudNavLink>
                            <MudNavLink Href="/user-wishlist" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Favorite" />
                                User Wishlist
                            </MudNavLink>
                        </Authorized>

                    </AuthorizeView>


                    <AuthorizeView Roles="@(ApplicationConst.Role_Admin)" Context="check2">
                        <Authorized>
                            <MudNavLink Href="/manage-products" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                                Manage Product
                            </MudNavLink>

                            <MudNavLink Href="/manage-categories" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                                Manage category
                            </MudNavLink>

                            <MudNavLink Href="/manage-orders" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                                Manage Orders
                            </MudNavLink>

                        </Authorized>

                    </AuthorizeView>


                    <AuthorizeView Roles="@(ApplicationConst.Role_ProductManager)" Context="check">
                        <Authorized>

                            <MudNavLink Href="/manage-products" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                                Manage Product
                            </MudNavLink>

                            <MudNavLink Href="/manage-categories" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                                Manage category
                            </MudNavLink>

                            <MudNavLink Href="/manage-orders" Match="NavLinkMatch.All">
                                <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                                Manage Orders
                            </MudNavLink>
                        </Authorized>

                    </AuthorizeView>

                    @*   <MudNavMenu>

                    <MudNavLink Href="/" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Dashboard" /> Home
                    </MudNavLink>

                    <MudNavLink Href="/weather" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Favorite" /> Weather
                    </MudNavLink>

                    <MudNavLink Href="/counter" Match="NavLinkMatch.All">
                    counter
                    </MudNavLink>
                    <MudNavLink Href="/saved-kundalis" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.TableView" />
                    Saved Kundali
                    </MudNavLink>
                    <MudNavLink Href="/products" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Shop" />
                    Shop
                    </MudNavLink>


                    <MudNavLink Href="/user-wishlist" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Favorite" />
                    User Wishlist
                    </MudNavLink>
                    <MudNavLink Href="/product-cart" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.ShoppingCart" /> Cart
                    </MudNavLink>
                    <MudNavLink Href="/my-orders" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                    Orders
                    </MudNavLink>

                    <MudNavLink Href="/transactions" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                    Transaction
                    </MudNavLink>

                    <MudNavLink Href="/token-recharge" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                    Recharge
                    </MudNavLink>

                    <MudNavLink Href="/manage-categories" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                    Manage category
                    </MudNavLink>

                    <MudNavLink Href="/manage-products" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                    Manage Product
                    </MudNavLink>

                    <MudNavLink Href="/manage-orders" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Assignment" />
                    Manage Orders
                    </MudNavLink>


                    <MudNavLink Href="/logout" Match="NavLinkMatch.All">
                    <MudIcon Icon="@Icons.Material.Filled.Logout" />
                    Logout
                    </MudNavLink>


                    </MudNavMenu> *@
                    <MudNavLink Href="/logout" Match="NavLinkMatch.All">
                        <MudIcon Icon="@Icons.Material.Filled.Logout" />
                        Logout
                    </MudNavLink>
                </MudDrawer>
                <MudMainContent>
                    @Body
                </MudMainContent>
            </Authorized>
            <NotAuthorized>
                @Body
            </NotAuthorized>
        </AuthorizeView>
    </MudLayout>
    @* </ChildContent> *@
    @* <ErrorContent>
    <AstroOfficeHybrid8.Components.Pages.NetworkLost></AstroOfficeHybrid8.Components.Pages.NetworkLost>
    </ErrorContent>
    </ErrorBoundary>
    *@

</CascadingValue>

@code {

    public string NavTitle { get; set; } = "Home";

    public async Task NotifyChangeAsync()
    {
        await InvokeAsync(StateHasChanged);
    }

    public void OnClick_BtnMenu() => IsDrawerOpen = !IsDrawerOpen;
}